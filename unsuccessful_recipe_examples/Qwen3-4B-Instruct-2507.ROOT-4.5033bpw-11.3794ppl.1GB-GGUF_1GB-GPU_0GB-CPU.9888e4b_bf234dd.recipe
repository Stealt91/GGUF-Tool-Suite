# iq1_m_r4 for the calibration dataset isn't producing good results for small LLMs
## Quant mix recipe created using Thireus' GGUF Tool Suite - https://gguf.thireus.com/
# Model name: Qwen3-4B-Instruct-2507
# Link to the original model: https://huggingface.co/Qwen/Qwen3-4B-Instruct-2507

## Model head & embeddings — qbits: 32 8 
output_norm\.weight=f32
token_embd\.weight=q8_0

## Multi-headed attention parameters — qbits: 32 6 
blk\.([0-9]|[1-2][0-9]|3[0-5])\.attn_k\.weight=iq6_k
blk\.([0-9]|[1-2][0-9]|3[0-5])\.attn_v\.weight=iq6_k
blk\.([0-9]|[1-2][0-9]|3[0-5])\.attn_output\.weight=iq6_k
blk\.([0-9]|[1-2][0-9]|3[0-5])\.attn_k_norm\.weight=f32
blk\.([0-9]|[1-2][0-9]|3[0-5])\.attn_norm\.weight=f32
blk\.([0-9]|[1-2][0-9]|3[0-5])\.attn_q_norm\.weight=f32
blk\.([0-9]|[1-2][0-9]|3[0-5])\.attn_q\.weight=iq6_k

## Core FFN weights — qbits: 32 4 3 2 
blk\.([0-3]|5|[7-8]|19|23|28|1[6-7]|[1-2][0-1]|1[3-4])\.ffn_gate\.weight=iq2_ks
blk\.(0|3|[5-6]|8|21|31|33|1[1-3]|2[4-8]|1[7-9])\.ffn_down\.weight=iq3_k
blk\.([0-4]|21|1[5-7]|1[1-3])\.ffn_up\.weight=iq2_ks
blk\.([0-9]|[1-2][0-9]|3[0-5])\.ffn_norm\.weight=f32
blk\.(20|24|31|3[3-5])\.ffn_up\.weight=iq4_ks
blk\.([5-9]|10|14|30|32|2[5-9]|1[8-9]|2[2-3])\.ffn_up\.weight=iq3_k
blk\.(4|6|9|12|15|18|22|29|2[4-7]|3[0-1])\.ffn_gate\.weight=iq3_k
blk\.([1-2]|7|20|1[5-6])\.ffn_down\.weight=iq2_ks
blk\.3[2-5]\.ffn_gate\.weight=iq4_ks
blk\.(4|9|10|14|29|30|32|2[2-3]|3[4-5])\.ffn_down\.weight=iq4_ks

## Summary of tensor sizes per class
# GPU Total: 1.113 GiB (100.0%) | 1.11 GiB max, if all were q8_0 | 1.11 GiB min, if all were q8_0
# CPU Total: 0.995 GiB (74.8%) | 1.33 GiB max, if all were iq4_ks | 0.68 GiB min, if all were iq2_ks
# GPU+CPU Total: 2.109 GiB (87.4%)

## Summary of tensor counts and bpw per qtype
#
# GPU-loaded quants:
# QTYPE		Count	BPW	Assigned GiB	% Assigned	Max GiB (all)
# +f32       	145	32.0  	  0.00 GiB	-		-
# q8_0      	1  	8.5   	  0.38 GiB	100.0%		0.38
# +iq6_k     	144	6.625 	  0.73 GiB	-		-
#
# CPU-loaded quants:
# QTYPE		Count	BPW	Assigned GiB	% Assigned	Max GiB (all)
# iq4_ks    	21 	4.25  	  0.26 GiB	19.4%		1.33
# iq3_k     	51 	3.4375	  0.51 GiB	47.2%		1.08
# iq2_ks    	36 	2.1875	  0.23 GiB	33.3%		0.68
#
# -Average BPW: 4.5033
#
# -Notes:
# - '+' means user-defined pre-assigned tensors, or tensor missing from csv data or f32 tensors
# - Recipe produced on the 2025-08-26 13:07:28 UTC+0000 using Thireus' GGUF tools (https://gguf.thireus.com/)
# - Script SHA-256: 9888e4b92ee591d5d115f263aea141ed8efb74f3224930195086bc2caeea6eb7
# - Calibration dataset 'ppl_results.csv' SHA-256: ebe2b483e0a4258f3a65806462b6f4f4a3669a70f664d03dbfcb5c4984ea240a
# - tensors.bf16.map SHA-256: 5586a523f4069ca3dbabf3b3db9b7514c239b74bd066c13b2c8039127c3fa0be
# - tensors.bf16.map model name: Qwen3-4B-Instruct-2507-THIREUS-BF16-SPECIAL_TENSOR-00399-of-00399
# - tensors.iq4_ks.map SHA-256: d9c6e71ab276dbec04373352b151c5460bd14a36cf7230ab1289ce59241759f9
# - tensors.iq4_ks.map model name: Qwen3-4B-Instruct-2507-THIREUS-IQ4_KS-SPECIAL_TENSOR-00399-of-00399
# - tensors.iq3_k.map SHA-256: fc8afc0b1ab1162f92efe31bd62d6ae54d7da62aafe5014e021f26a4d3ce574c
# - tensors.iq3_k.map model name: Qwen3-4B-Instruct-2507-THIREUS-IQ3_K-SPECIAL_TENSOR-00399-of-00399
# - tensors.iq2_ks.map SHA-256: 405cbb91c54dc596f71c21029da6db9bcb654600e51d314c33515fd58bf576ef
# - tensors.iq2_ks.map model name: Qwen3-4B-Instruct-2507-THIREUS-IQ2_KS-SPECIAL_TENSOR-00399-of-00399
# - tensors.q8_0.map SHA-256: 18f39f0eccaaea43cad179f7ed2f98944ae86a88a90b53e6fd1483bdbf5e65ee
# - tensors.q8_0.map model name: Qwen3-4B-Instruct-2507-THIREUS-Q8_0-SPECIAL_TENSOR-00399-of-00399
# - tensors.iq1_m_r4.map SHA-256: cf53fc87090eeb9c2a53f5f0b8f50defe3150d7a31f76638d6ed9cb4d01c56f3
# - tensors.iq1_m_r4.map model name: Qwen3-4B-Instruct-2507-THIREUS-IQ1_M_R4-SPECIAL_TENSOR-00399-of-00399
# - tensors.iq6_k.map SHA-256: 751e52ccaa99070476abd91b8d8b701a12099263e2f27c0bbca68db81434dff1
# - tensors.iq6_k.map model name: Qwen3-4B-Instruct-2507-THIREUS-IQ6_K-SPECIAL_TENSOR-00399-of-00399
# - GPG signatures: PASSED
# - Command used:
# ../../quant_assign.py ppl_results.csv --tolerance 0.01 --cpu-irq-k 1.5 --gpu-irq-k 1.5 --qtype iq1_m_r4 \
# --gpu-assign-qtype iq6_k --cpu-tensors-max-size 1 --gpu-tensors-max-size 95% --exponential-factor 8 --cpu-tensors \
# 'blk\.([0-9]|[1-2][0-9]|3[0-5])\.ffn_down\.weight' 'blk\.([0-9]|[1-2][0-9]|3[0-5])\.ffn_up\.weight' \
# 'blk\.([0-9]|[1-2][0-9]|3[0-5])\.ffn_gate\.weight' --gpu-tensors '.*' --cpu-quants iq4_ks iq3_k iq2_ks --gpu-quants \
# q8_0 --gpu-assign-tensors 'blk\.([0-9]|[1-2][0-9]|3[0-5])\.attn_k_b\.weight=q8_0' --harmonization-technique 3

## THE END!

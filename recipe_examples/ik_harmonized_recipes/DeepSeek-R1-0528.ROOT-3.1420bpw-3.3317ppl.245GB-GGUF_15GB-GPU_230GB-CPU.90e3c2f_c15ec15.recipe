## Quant mix recipe created using Thireus' GGUF Tool Suite - https://gguf.thireus.com/
# Model name: DeepSeek-R1-0528
# Link to the original model: https://huggingface.co/deepseek-ai/DeepSeek-R1-0528

## Model head & embeddings — qbits: 32 16 
^output_norm\.weight$=f32
^token_embd\.weight$=bf16
^output\.weight$=bf16

## Special attention kernels — single-quant only (llama-quantize takes care of it) — qbits: 8 
^blk\.([0-9]|[1-5][0-9]|60)\.attn_k_b\.weight$=q8_0

## Multi-headed attention parameters — qbits: 32 5 
^blk\.([0-9]|[1-5][0-9]|60)\.attn_kv_a_mqa\.weight$=iq5_k_r4
^blk\.([0-9]|[1-5][0-9]|60)\.attn_output\.weight$=iq5_k_r4
^blk\.([0-9]|[1-5][0-9]|60)\.attn_kv_a_norm\.weight$=f32
^blk\.([0-9]|[1-5][0-9]|60)\.attn_q_b\.weight$=iq5_k_r4
^blk\.([0-9]|[1-5][0-9]|60)\.attn_q_a\.weight$=iq5_k_r4
^blk\.([0-9]|[1-5][0-9]|60)\.attn_q_a_norm\.weight$=f32
^blk\.([0-9]|[1-5][0-9]|60)\.attn_kv_b\.weight$=iq5_k_r4
^blk\.([0-9]|[1-5][0-9]|60)\.attn_norm\.weight$=f32
^blk\.([0-9]|[1-5][0-9]|60)\.attn_v_b\.weight$=iq5_k_r4

## Core FFN weights — qbits: 32 8 6 5 
^blk\.([3-9]|[1-5][0-9]|60)\.ffn_gate_inp\.weight$=f32
^blk\.1\.ffn_down\.weight$=iq6_k
^blk\.0\.ffn_gate\.weight$=iq5_k_r4
^blk\.([0-9]|[1-5][0-9]|60)\.ffn_norm\.weight$=f32
^blk\.0\.ffn_down\.weight$=q8_0
^blk\.2\.ffn_gate\.weight$=q8_0
^blk\.2\.ffn_down\.weight$=iq5_k_r4
^blk\.1\.ffn_gate\.weight$=iq6_k
^blk\.2\.ffn_up\.weight$=iq6_k
^blk\.[0-1]\.ffn_up\.weight$=iq5_k_r4

## Other tensors — qbits: 32 
^blk\.([3-9]|[1-5][0-9]|60)\.exp_probs_b\.bias$=f32

## GPU-loaded ffn_*_shexp
# ffn_down_shexp (down-projection) — qbits: 16 8 6 5 
^blk\.(11|20|26|29|3[0-1]|36)\.ffn_down_shexp\.weight$=q8_0
^blk\.([3-5]|8|12|1[4-6]|19|22|2[4-5]|2[7-8]|32|3[4-5]|4[0-9]|3[7-9]|5[0-4]|5[7-8])\.ffn_down_shexp\.weight$=iq6_k
^blk\.([6-7]|9|10|13|18|5[5-6]|59)\.ffn_down_shexp\.weight$=iq5_k_r4
^blk\.(17|21|23|33|60)\.ffn_down_shexp\.weight$=bf16

# ffn_up_shexp (up-projection) — qbits: 16 8 6 5 
^blk\.(15|18|24|2[8-9]|3[3-4]|37)\.ffn_up_shexp\.weight$=q8_0
^blk\.([5-6]|[8-9]|1[0-4]|17|20|2[2-3]|27|3[0-2]|3[5-6]|3[8-9]|4[0-3]|4[5-9]|5[0-1]|5[3-4]|56|58)\.ffn_up_shexp\.weight$=iq6_k
^blk\.([3-4]|7|16|19|25|44|52|55|57|59)\.ffn_up_shexp\.weight$=iq5_k_r4
^blk\.(21|26|60)\.ffn_up_shexp\.weight$=bf16

# ffn_gate_shexp (gate-projection) — qbits: 16 8 6 5 
^blk\.(16|18|2[3-5]|4[8-9]|50|57)\.ffn_gate_shexp\.weight$=q8_0
^blk\.([4-5]|7|1[2-5]|17|19|2[0-1]|3[0-9]|2[6-9]|4[1-7]|5[1-6]|58)\.ffn_gate_shexp\.weight$=iq6_k
^blk\.(3|6|[8-9]|1[0-1]|22|40|59)\.ffn_gate_shexp\.weight$=iq5_k_r4
^blk\.60\.ffn_gate_shexp\.weight$=bf16

## CPU-friendly ffn_*_exps
# ffn_down_exps (down-extraction) — qbits: 4 3 2 1 
^blk\.(3[2-9]|4[0-2]|4[4-9]|51)\.ffn_down_exps\.weight$=iq4_ks
^blk\.(1[1-2]|14|18|2[0-9]|3[0-1]|43|50|5[2-8]|60)\.ffn_down_exps\.weight$=iq3_k
^blk\.(10|16|19|59)\.ffn_down_exps\.weight$=iq2_k
^blk\.([3-9]|13|15|17)\.ffn_down_exps\.weight$=iq1_m_r4

# ffn_up_exps (up-extraction) — qbits: 4 3 2 1 
^blk\.(44|47|55)\.ffn_up_exps\.weight$=iq4_ks
^blk\.(2[4-5]|27|3[1-9]|4[0-3]|4[5-6]|4[8-9]|5[0-4]|5[6-8]|60)\.ffn_up_exps\.weight$=iq3_k
^blk\.(5|1[2-6]|18|2[0-2]|26|2[8-9]|30|59)\.ffn_up_exps\.weight$=iq2_k
^blk\.([3-4]|[6-9]|1[0-1]|17|19|23)\.ffn_up_exps\.weight$=iq1_m_r4

# ffn_gate_exps (gate-extraction) — qbits: 4 3 2 1 
^blk\.(44|47|55)\.ffn_gate_exps\.weight$=iq4_ks
^blk\.(2[4-5]|27|3[1-9]|4[0-3]|4[5-6]|4[8-9]|5[0-4]|5[6-8]|60)\.ffn_gate_exps\.weight$=iq3_k
^blk\.(5|1[2-6]|18|2[0-2]|26|2[8-9]|30|59)\.ffn_gate_exps\.weight$=iq2_k
^blk\.([3-4]|[6-9]|1[0-1]|17|19|23)\.ffn_gate_exps\.weight$=iq1_m_r4

## Summary of tensor sizes per class
# GPU Total: 15.035 GiB (79.3%) | 18.97 GiB max, if all were bf16 | 12.13 GiB min, if all were iq5_k_r4
# CPU Total: 230.781 GiB (71.3%) | 323.53 GiB max, if all were iq4_ks | 133.22 GiB min, if all were iq1_m_r4
# GPU+CPU Total: 245.816 GiB (75.3%)

## Summary of tensor counts and bpw per qtype
#
# GPU-loaded quants:
# QTYPE		Count	BPW	Assigned GiB	% Assigned	Max GiB (all)
# +f32       	361	32.0  	  0.40 GiB	-		-
# bf16      	11 	16.0  	  3.70 GiB	35.5%		10.42
# +q8_0      	61 	8.5   	  0.51 GiB	-		-
# q8_0      	26 	8.5   	  0.61 GiB	11.0%		5.54
# iq6_k     	115	6.625 	  1.57 GiB	36.5%		4.32
# +iq5_k_r4  	366	5.5   	  7.64 GiB	-		-
# iq5_k_r4  	33 	5.5   	  0.61 GiB	17.0%		3.58
#
# CPU-friendly quants:
# QTYPE		Count	BPW	Assigned GiB	% Assigned	Max GiB (all)
# iq4_ks    	24 	4.25  	 44.62 GiB	13.8%		323.53
# iq3_k     	84 	3.4375	126.33 GiB	48.3%		261.68
# iq2_k     	34 	2.375 	 35.33 GiB	19.5%		180.80
# iq1_m_r4  	32 	1.75  	 24.50 GiB	18.4%		133.22
#
# -Average BPW: 3.1420
#
# -Notes:
# - '+' means user-defined pre-assigned tensors, or tensor missing from csv data or f32 tensors
# - Recipe produced on the 2025-09-03 18:27:00 UTC+0000 using Thireus' GGUF tools (https://gguf.thireus.com/)
# - Script SHA-256: 90e3c2fafeb4aa4360e9fed16bf2aa8f5be90c24da90bd656f38ca48bf77bd1d
# - Calibration dataset 'ppl_results.csv' SHA-256: b45b30a282e29922fc46ea4a030f1aa27df5be790c9d921cfac0fba27adc3faa
# - tensors.bf16.map SHA-256: f264323f789d0da78bc21ccf208cbb16709c5808c9c1f939a0c78f7c03c1ece1
# - tensors.bf16.map model name: DeepSeek-R1-0528-THIREUS-BF16-SPECIAL_TENSOR-01148-of-01148
# - tensors.iq4_ks.map SHA-256: d5f6bb2f932668cbea57f0910e235759b56e7ae5f0e0e1420af7c8e40d824a51
# - tensors.iq4_ks.map model name: DeepSeek-R1-0528-THIREUS-IQ4_KS-SPECIAL_TENSOR-01148-of-01148
# - tensors.iq3_k.map SHA-256: 2c31f9d9e03ea9c6bc98ba34adad5ff355c775895fdaa7e3a21f7d6c0738e7cf
# - tensors.iq3_k.map model name: DeepSeek-R1-0528-THIREUS-IQ3_K-SPECIAL_TENSOR-01148-of-01148
# - tensors.iq2_k.map SHA-256: 1c0aa621e5dcd5e7425d77a5307c228d5a06dbd6db381958601b943c8205fffe
# - tensors.iq2_k.map model name: DeepSeek-R1-0528-THIREUS-IQ2_K-SPECIAL_TENSOR-01148-of-01148
# - tensors.iq1_m_r4.map SHA-256: 895e207c15f5e8a2c81f5b7061b0fe3a64a481b83c9499fb75ad7724f92d6c25
# - tensors.iq1_m_r4.map model name: DeepSeek-R1-0528-THIREUS-IQ1_M_R4-SPECIAL_TENSOR-01148-of-01148
# - tensors.q8_0.map SHA-256: 8d064fb71d986348b38df6d0517ba527dd5bbd25cd1f45535971087f042f1b32
# - tensors.q8_0.map model name: DeepSeek-R1-0528-THIREUS-Q8_0-SPECIAL_TENSOR-01148-of-01148
# - tensors.iq5_k_r4.map SHA-256: 2861a8c7aafa9d7477a444292b038b6dc5149192ba84c23d747a839f5ec57d07
# - tensors.iq5_k_r4.map model name: DeepSeek-R1-0528-THIREUS-IQ5_K_R4-SPECIAL_TENSOR-01148-of-01148
# - tensors.iq6_k.map SHA-256: c2b301156703fd3d360a6a9406d5079bd6625c2f7557f89c7de632df78eed822
# - tensors.iq6_k.map model name: DeepSeek-R1-0528-THIREUS-IQ6_K-SPECIAL_TENSOR-01148-of-01148
# - GPG signatures: PASSED
# - Command used:
# ../../quant_assign.py ppl_results.csv --tolerance 0.01 --cpu-irq-k 1.5 --gpu-irq-k 1.5 --gpu-assign-qtype iq5_k_r4 \
# --cpu-tensors-max-size 230 --gpu-tensors-max-size 15 --exponential-factor 8 --cpu-tensors \
# 'blk\.([3-9]|[1-5][0-9]|60)\.ffn_down_exps\.weight' 'blk\.([3-9]|[1-5][0-9]|60)\.ffn_up_exps\.weight' \
# 'blk\.([3-9]|[1-5][0-9]|60)\.ffn_gate_exps\.weight' --gpu-tensors '.*' --cpu-quants iq4_ks iq3_k iq2_k iq1_m_r4 \
# --gpu-quants bf16 q8_0 iq5_k_r4 iq6_k --gpu-assign-tensors 'blk\.([0-9]|[1-5][0-9]|60)\.attn_k_b\.weight=q8_0' \
# --harmonize-tensors '^blk\..*\.ffn_up_exps.*,blk\..*\.ffn_gate_exps.*' --harmonization-technique 3

## THE END!
